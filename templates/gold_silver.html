+<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gold & Silver Prices in India - Live Rates</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: arial, sans-serif;
            background-color: #fff;
            color: #202124;
            line-height: 1.6;
        }
        .container-main {
            max-width: 1120px;
            margin: 0 auto;
            padding: 20px 16px;
        }
        .price-header {
            margin-bottom: 16px;
        }
        .price-title {
            font-size: 20px;
            color: #202124;
            margin: 0;
            font-weight: 400;
        }
        .price-value {
            font-size: 32px;
            font-weight: 400;
            color: #202124;
            margin: 8px 0;
        }
        .price-meta {
            font-size: 14px;
            color: #70757a;
            margin-top: 4px;
        }
        .price-change {
            font-size: 14px;
            font-weight: 500;
            margin-left: 8px;
        }
        .price-change.positive {
            color: #137333;
        }
        .price-change.negative {
            color: #ea4335;
        }
        .state-selector {
            margin: 16px 0;
        }
        .state-selector select {
            padding: 8px 32px 8px 12px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
            cursor: pointer;
        }
        .state-selector select:focus {
            outline: none;
            border-color: #1a73e8;
        }
        .period-selector {
            display: flex;
            gap: 0;
            margin: 16px 0;
            border-bottom: 1px solid #dadce0;
        }
        .period-btn {
            padding: 8px 16px;
            border: none;
            background: none;
            color: #5f6368;
            font-size: 14px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            margin-bottom: -1px;
        }
        .period-btn:hover {
            color: #202124;
        }
        .period-btn.active {
            color: #1a73e8;
            border-bottom-color: #1a73e8;
        }
        .chart-container {
            margin: 24px 0;
            height: 300px;
            position: relative;
        }
        .metal-selector {
            margin-bottom: 16px;
        }
        .metal-btn {
            padding: 8px 16px;
            border: 1px solid #dadce0;
            background: #fff;
            color: #202124;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            margin-right: 8px;
        }
        .metal-btn.active {
            background: #1a73e8;
            color: #fff;
            border-color: #1a73e8;
        }
        .disclaimer {
            margin-top: 24px;
            padding: 16px;
            background-color: #f8f9fa;
            border-left: 3px solid #1a73e8;
            font-size: 13px;
            color: #5f6368;
        }
        .disclaimer-title {
            font-weight: 500;
            color: #202124;
            margin-bottom: 8px;
        }
    </style>
</head>
<body>
    <div class="container-main">
        <!-- Metal Selector -->
        <div class="metal-selector">
            <button class="metal-btn active" onclick="switchMetal('gold')" id="btnGold">Gold</button>
            <button class="metal-btn" onclick="switchMetal('silver')" id="btnSilver">Silver</button>
        </div>

        <!-- Price Header -->
        <div class="price-header">
            <div class="price-title" id="priceTitle">10g of 24k gold (99.9%) in <span id="stateName">Karnataka</span> is</div>
            <div class="price-value" id="priceValue">Loading...</div>
            <div class="price-meta">
                <span id="timestamp"></span>
                <span class="price-change" id="priceChange"></span>
            </div>
        </div>

        <!-- State Selector -->
        <div class="state-selector">
            <select id="stateSelect" onchange="updatePrices()">
                <option value="Andhra Pradesh">Andhra Pradesh</option>
                <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                <option value="Assam">Assam</option>
                <option value="Bihar">Bihar</option>
                <option value="Chhattisgarh">Chhattisgarh</option>
                <option value="Goa">Goa</option>
                <option value="Gujarat">Gujarat</option>
                <option value="Haryana">Haryana</option>
                <option value="Himachal Pradesh">Himachal Pradesh</option>
                <option value="Jharkhand">Jharkhand</option>
                <option value="Karnataka" selected>Karnataka</option>
                <option value="Kerala">Kerala</option>
                <option value="Madhya Pradesh">Madhya Pradesh</option>
                <option value="Maharashtra">Maharashtra</option>
                <option value="Manipur">Manipur</option>
                <option value="Meghalaya">Meghalaya</option>
                <option value="Mizoram">Mizoram</option>
                <option value="Nagaland">Nagaland</option>
                <option value="Odisha">Odisha</option>
                <option value="Punjab">Punjab</option>
                <option value="Rajasthan">Rajasthan</option>
                <option value="Sikkim">Sikkim</option>
                <option value="Tamil Nadu">Tamil Nadu</option>
                <option value="Telangana">Telangana</option>
                <option value="Tripura">Tripura</option>
                <option value="Uttar Pradesh">Uttar Pradesh</option>
                <option value="Uttarakhand">Uttarakhand</option>
                <option value="West Bengal">West Bengal</option>
                <option value="Delhi">Delhi</option>
                <option value="Puducherry">Puducherry</option>
            </select>
        </div>

        <!-- Period Selector -->
        <div class="period-selector">
            <button class="period-btn" onclick="changePeriod('5D')" id="period5D">5D</button>
            <button class="period-btn active" onclick="changePeriod('1M')" id="period1M">1M</button>
            <button class="period-btn" onclick="changePeriod('1Y')" id="period1Y">1Y</button>
            <button class="period-btn" onclick="changePeriod('Max')" id="periodMax">Max</button>
        </div>

        <!-- Chart -->
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>

        <!-- Disclaimer -->
        <div class="disclaimer">
            <div class="disclaimer-title">Disclaimer</div>
            <div>Gold and silver prices are indicative and may vary based on market conditions, making charges, and other factors. Prices shown are for 24k gold (99.9% purity) and silver per 10 grams. State premiums are approximate and actual prices may differ. This information should not be used as the sole basis for making investment decisions. Always consult with a certified gold/silver dealer or financial advisor before making any purchase.</div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let currentMetal = 'gold';
        let currentState = 'Karnataka';
        let currentPeriod = '1M';
        let priceChart = null;
        let updateInterval = null;

        const states = [
            'Andhra Pradesh', 'Arunachal Pradesh', 'Assam', 'Bihar', 'Chhattisgarh',
            'Goa', 'Gujarat', 'Haryana', 'Himachal Pradesh', 'Jharkhand',
            'Karnataka', 'Kerala', 'Madhya Pradesh', 'Maharashtra', 'Manipur',
            'Meghalaya', 'Mizoram', 'Nagaland', 'Odisha', 'Punjab',
            'Rajasthan', 'Sikkim', 'Tamil Nadu', 'Telangana', 'Tripura',
            'Uttar Pradesh', 'Uttarakhand', 'West Bengal', 'Delhi', 'Puducherry'
        ];

        function switchMetal(metal) {
            currentMetal = metal;
            document.getElementById('btnGold').classList.toggle('active', metal === 'gold');
            document.getElementById('btnSilver').classList.toggle('active', metal === 'silver');
            updatePrices();
        }

        function changePeriod(period) {
            currentPeriod = period;
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('period' + period).classList.add('active');
            updatePrices();
        }

        function formatPrice(price) {
            return '₹' + price.toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            return `${date.getDate()} ${months[date.getMonth()]}, ${date.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', hour12: true })} IST`;
        }

        function formatDateShort(dateStr) {
            const date = new Date(dateStr);
            return `${date.getDate()} ${date.toLocaleDateString('en-IN', { month: 'short' })}`;
        }

        async function updatePrices() {
            currentState = document.getElementById('stateSelect').value;
            
            try {
                const response = await fetch(`/api/gold-silver-prices?metal=${currentMetal}&state=${encodeURIComponent(currentState)}&period=${currentPeriod}`);
                const data = await response.json();

                if (!data.success) {
                    document.getElementById('priceValue').textContent = 'Error loading price';
                    return;
                }

                // Update title
                const metalText = currentMetal === 'gold' ? '24k gold (99.9%)' : 'silver';
                document.getElementById('priceTitle').innerHTML = `10g of ${metalText} in <span id="stateName">${currentState}</span> is`;
                
                // Update price
                document.getElementById('priceValue').textContent = formatPrice(data.price);
                
                // Update timestamp
                const timestamp = new Date(data.timestamp);
                document.getElementById('timestamp').textContent = formatDate(data.timestamp) + ' ';
                
                // Update change
                const changeEl = document.getElementById('priceChange');
                if (data.change !== null && data.change_percent !== null) {
                    const sign = data.change >= 0 ? '+' : '';
                    changeEl.textContent = `${sign}${formatPrice(Math.abs(data.change))} (${sign}${data.change_percent.toFixed(2)}%)`;
                    changeEl.className = 'price-change ' + (data.change >= 0 ? 'positive' : 'negative');
                } else {
                    changeEl.textContent = '';
                }

                // Update chart
                updateChart(data.historical || []);

            } catch (error) {
                console.error('Error fetching prices:', error);
                document.getElementById('priceValue').textContent = 'Error loading price';
            }
        }

        function updateChart(historical) {
            if (!historical || historical.length === 0) {
                if (priceChart) {
                    priceChart.destroy();
                    priceChart = null;
                }
                return;
            }

            const ctx = document.getElementById('priceChart').getContext('2d');
            
            const labels = historical.map(h => formatDateShort(h.date));
            const prices = historical.map(h => h.price);
            
            const minPrice = Math.min(...prices);
            const maxPrice = Math.max(...prices);
            const padding = (maxPrice - minPrice) * 0.1;

            if (priceChart) {
                priceChart.destroy();
            }

            // Define colors based on metal using Bootstrap-inspired colors
            const colors = {
                gold: {
                    border: '#ffc107', // Bootstrap warning color (gold-like)
                    background: 'rgba(255, 193, 7, 0.1)' // Light gold background
                },
                silver: {
                    border: '#6c757d', // Bootstrap secondary color (silver-like)
                    background: 'rgba(108, 117, 125, 0.1)' // Light gray background
                }
            };

            const metalColors = colors[currentMetal];

            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: `${currentMetal === 'gold' ? 'Gold' : 'Silver'} Price (₹)`,
                        data: prices,
                        borderColor: metalColors.border,
                        backgroundColor: metalColors.background,
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return formatPrice(context.parsed.y);
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                color: '#5f6368'
                            }
                        },
                        y: {
                            min: Math.max(0, minPrice - padding),
                            max: maxPrice + padding,
                            grid: {
                                color: '#f1f3f4'
                            },
                            ticks: {
                                font: {
                                    size: 11
                                },
                                color: '#5f6368',
                                callback: function(value) {
                                    const num = Math.round(value);
                                    if (num >= 100000) {
                                        return '₹' + (num / 100000).toFixed(1) + 'L';
                                    } else if (num >= 1000) {
                                        return '₹' + (num / 1000).toFixed(1) + 'K';
                                    }
                                    return '₹' + num;
                                }
                            }
                        }
                    },
                    interaction: {
                        mode: 'index',
                        intersect: false
                    }
                }
            });
        }

        // Initialize
        updatePrices();
        
        // Update every 30 seconds
        updateInterval = setInterval(updatePrices, 30000);

        // Clean up on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        });
    </script>
</body>
</html>
